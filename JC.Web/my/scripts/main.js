/*! huishen 2016-07-27 */
function gInitNode(){wrapper=$("#j_ContentWrapperMain"),tabs=wrapper.children(".content-wrapper-main-menu"),conts=wrapper.children(".content-wrapper-main-center"),menus=$(".sidebar-menu")}function gLoadUserMenu(){var a="gUzaiManagerMenu",b=(_uzw.cookie.get(a),_util.localStorage.get(a),["fa-area-chart","fa-headphones","fa-pie-chart","fa-list","fa-dollar","fa-cubes","fa-briefcase","fa-search","fa-cc-visa","fa-tv","fa-hourglass-end","fa-truck","fa-thumbs-o-up","fa-battery-3","fa-qq","fa-wifi","fa-user","fa-gear"]),c=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],d=function(){var a=$.ajax({url:"/ashx/modules.ashx",cache:!0,type:"GET",dataType:"json",beforeSend:function(){menus.append('<li class="menu-loading tc"><i class="fa fa-spinner"></i> 菜单载入中...</li>')}});return a.fail(function(){a.doneExt()}),a.doneExt=function(a){setTimeout(function(){menus.find(".menu-loading").remove(),a&&a()},2e3)},a};_util.localStorage.cache(a,1,d,function(a){function d(a){var e="";return $.each(a,function(a,f){var h=f.url?f.url.indexOf("//")>-1?f.url:rootUrl+f.url:"#",i=!1;"false"==f.leaf&&0==f.parentid&&(i=!0),i&&(g=c.indexOf(parseInt(f.orderby))),e+="<li class='treeview' data-id='"+f.id+"' data-txt='"+f.text+"' data-href='"+h+"' data-target='"+f.target+"'>",e+="<a>",e+="<i class='fa "+(i?b[g]:"fa-circle-o")+"'></i> <span>"+f.text+"</span>",e+="<i class='fa pull-right "+("false"==f.leaf?"fa-angle-left":"")+"'></i>","_blank"==f.target&&(e+="<i class='fa fa-mail-forward pull-right'></i>"),e+="</a>",f&&f.children&&(e+="<ul class='treeview-menu'>",e+=d(f.children),e+="</ul>"),e+="</li>"}),e}if(a){var e=a.data.m_StringValue;if(e){var f=JSON.parse(e);if(f&&f.length){var g=0,h=d(f);menus.children(".header").eq(0).after(h)}}}})}function gContextMenu(){var a=[[{text:"关闭当前页",func:function(){var a=$(this);a.index();a.find(".fa-close").trigger("click")}},{text:"关闭其他",func:function(){var a=$(this),b=(a.index(),tabs.find(".item")),c=conts.children(".content-wrapper-main-item");b.not(a).not(":first").remove(),c.filter(":hidden").not(":first").remove()}}],[{text:"关闭所有",func:function(){tabs.find(".item").not(":first").remove(),conts.children(".content-wrapper-main-item").not(":first").remove(),gPageTab.active(0)}},{text:"刷新",func:function(){var a=$(this),b=(a.index(),a.attr("data-id"));a.attr("data-href"),tabs.find(".item"),conts.children(".content-wrapper-main-item");gPageTab.refresh(b)}}]];tabs.find(".item").smartMenu(a,{name:"image",beforeShow:function(){$(this).trigger("click")},afterShow:function(){var a=$("#smartMenu_image");a.find(".smart_menu_li_separate").addClass("divider"),a.find(".smart_menu_ul").addClass("dropdown-menu").show()}})}function gFixIframeHeight(){var a=conts.children(".content-wrapper-main-item").find("iframe");a.each(function(){var a=$(this),b=a.parent(".content");a.css("min-height",b.height()),a.iFrameResize({log:!1})})}function gTriggerMenu(){var a=$("#j_shortcutTop").find(".my-trigger");a.on("click",function(){var a=$(this),b=a.attr("href"),c=$(".sidebar").find(".treeview[data-href='"+b+"']");return c.trigger("click"),!1})}var wrapper,tabs,conts,menus,rootUrl="",pageTab=window.pageTab||{};$(function(){gInitNode(),gLoadUserMenu(),gPageTab.init(),gContextMenu(),gFixIframeHeight(),gTriggerMenu()}),gPageTab={init:function(){this.slide(),this.append(),this.click(),this.dblclick(),this.close()},getMaxTabNum:function(){var a=$("#j_menuList"),b=a.outerWidth(),c=a.find(".item"),d=(c.length,20),e=0;return c.each(function(a,c){return e+=$(this).outerWidth(),e>=b?(d=a-1,!1):void(d=a+1)}),d},slide:function(){var a=this.getMaxTabNum();$.fn.slick&&$("#j_menuList").slick({prevArrow:".slick-prev",nextArrow:".slick-next",slidesToShow:a,slidesToScroll:1,dots:!1,infinite:!1,speed:300,centerMode:!1,variableWidth:!0})},append:function(){var a=this;menus.on("click",".treeview",function(){var b=$(this),c=b.attr("data-href"),d=b.attr("data-id"),e=b.attr("data-txt"),f=b.attr("data-target");if("_blank"!=f)if(a.check(d))a.refresh(d);else if(c&&"#"!=c){a.clear();var g="<div data-id='"+d+"' data-href='"+c+"' class='item on'><span>"+e+"</span><i class='fa fa-close'></i></div>";$("#j_menuList").slick("slickAdd",g),$("#j_menuList").slick("slickSetOption","slidesToShow",a.getMaxTabNum(),!0);var h="<section class='content-header'><h1>"+e+"<small></small></h1><ol class='breadcrumb'><li><a href='#'><i class='fa fa-dashboard'></i> 首页</a></li><li class='active'>"+e+"</li></ol></section>",i="<section class='content'><iframe class='j_iframeInnerPage' id='j_iframeInnerPage"+d+"' src='"+c+"' frameborder='0'></iframe></section>",j="<div class='content-loader'><span class='fa fa-spinner'></span></div>";conts.append('<div class="content-wrapper-main-item">'+j+"<div class='content-main'>"+h+i+"</div></div>"),gContextMenu(),a.refresh(d)}})},check:function(a){return tabs.find(".item[data-id="+a+"]").get(0)},click:function(){var a=this;tabs.on("click",".item",function(){var b=$(this),c=b.index(),d=tabs.find(".item"),e=conts.children(".content-wrapper-main-item");a.clear(),d.eq(c).addClass("on"),e.eq(c).show()})},dblclick:function(){var a=this;tabs.on("dblclick",".item",function(){a.active();var b=a.get();b.find(".fa-close").trigger("click")})},active:function(a){tabs.find(".item[data-id="+a+"]").trigger("click")},clear:function(){tabs.find(".item").removeClass("on"),conts.children(".content-wrapper-main-item").hide()},refresh:function(a){this.active(a),_uzw.ui.mask.show(function(){});var b=this.index(),c=conts.find(".content-wrapper-main-item").eq(b);c.removeClass("content-wrapper-main-item-off");var d=c.find("iframe");d.attr("src",this.get().attr("data-href")+"#"+Math.random()),d.on("load",function(){gFixIframeHeight()}),setTimeout(function(){_uzw.ui.mask.hide(function(){c.addClass("content-wrapper-main-item-off")})},2e3)},index:function(){return this.get().index()},get:function(){return tabs.find(".item").filter(".on")},close:function(){var a=this;tabs.on("click",".fa-close",function(){var b=$(this),c=b.parent(".item"),d=c.attr("data-id");if(0!=d){var e=c.index(),f=tabs.find(".item"),g=conts.children(".content-wrapper-main-item");return f.eq(e).remove(),g.eq(e).remove(),f=tabs.find(".item"),f.length>e?f.eq(e).trigger("click"):f.eq(e-1).trigger("click"),$("#j_menuList").slick("slickSetOption","slidesToShow",a.getMaxTabNum(),!0),!1}})}};